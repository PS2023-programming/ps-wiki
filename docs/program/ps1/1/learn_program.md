# 框架代码导读

!!! Warning "难度警示"

    我们在上手任何任务时都存在一个学习曲线。在项目任务中，尤其是对于零基础的同学，这将会是学习曲线最为陡峭之处。*请充分重视第一阶段，否则你很有可能无法完成后续所有阶段。*

    这一部分要求完成的任务很少，而我们仍为它[安排了一周的时间](../../../../schedule/ps1/#_5)，**但这不是中间休息时间**。我们希望你能用一周的时间[认真阅读讲义](../../../#_3)，并确保理解了框架的代码。

RTFSC 是 Reading The Fucking Source Code 的缩写，来自于 [Linus](https://zh.wikipedia.org/wiki/%E6%9E%97%E7%BA%B3%E6%96%AF%C2%B7%E6%89%98%E7%93%A6%E5%85%B9) 在邮件中的「友善」嘴臭。

虽然骂人不好，但这话更像自言自语，有如「It's time to read the fucking source code」。它提醒我们：无论是在初步接手一个项目，抑或是遇到了一些疑难杂症时，沉下心来读一读源代码都很可能对我们大有裨益。

但不少同学作为初学者，哪怕对于小型项目的结构和代码都感到一头雾水

由此，作为第一阶段的开端，在本部分中我们为大家介绍阅读框架代码所必须的前置知识，并通过阅读代码了解框架代码的大略架构。

## 代码组织与构建

在第零阶段我们说过，项目中共有两个可执行文件：游戏和启动器。

启动器是一个单源文件程序，而游戏对应着多份源代码。在 OJ 中，大家也许习惯于编写一个源文件而得到对应的程序，但是对于复杂的项目，只使用一个源文件构建得到一个程序是不现实的。试想如果一个源文件中有着数万乃至数十万行代码，会使得阅读和维护代码变得多么麻烦？

因此，我们需要将代码按照模块分成多个文件。你可以在如下目录下找到游戏的源代码：`test/phase1` 和 `minitui`。你还会注意到代码文件分为两类：

+ `.h` 结尾的**头文件**（Header File），一般存放在 `include` 目录下。
+ `.cpp` 结尾的**源文件**（Source File），一般存放在 `source` 目录下。

下面我们来细讲一下这两类文件的区别和作用，并介绍一下预编译命令以及代码的构建流程。

### 头文件和 `#include`

你每次编写的代码的第一行都有可能是 `#include <cstdio>` 或 `#include <iostream>` 乃至 `#include <bits/stdc++.h>`。这些尖括号内的文件就是标准库为我们提供的头文件。

头文件的作用是提供变量的 `extern` 声明和[函数声明](../../../../lang/func/)，它一般通过 `#include` 命令而被引入到程序中（这种引入就是文本替换，并可以递归）。

`#include` 这种以 `#` 起始的命令叫做**预编译命令**。处理预编译命令是 C/C++ 源文件编译流程的第一步，我们在此后还会遇见其它的预编译命令，它们同样具有重要作用。

???+ example "观察 `#include` 命令的作用和预编译过程"
    你可以写一个简单的 Hello World 程序（`hello.cpp`），并使用如下命令指示编译器进行预编译：

    ```shell
    g++ -E hello.cpp -o hello_pre.cpp
    ```

    观察 `hello_pre.cpp`，你发现了什么？

#### 头文件的搜索路径

在引用头文件如 `cstdio.h` 时，我们发现头文件既不在代码文件对应的目录下，也不在 `PATH` 环境变量所指定的路径下，GCC 到底是从哪里找到这个文件的呢？

如果你使用带语法提示的编辑器或 IDE，那么在代码文件中你可能发现引用诸如 `ansi.h` 或 `basics.h` 时会被标红线，提示找不到该文件，但编译时却可以通过，这是为什么呢？

这些都和 `#include<$FILE>` 时编译器的搜索路径有关。在这一格式的命令中，编译器会从标准库 `include` 路径下寻找对应的文件，然后从用户指定的 `include` 路径中寻找文件。如果你执行 `echo | gcc -xc++ -E -v -` 命令，你将会看到：

```shell
#include <...> search starts here:
 /usr/lib/gcc/x86_64-pc-msys/11.3.0/include/c++
 /usr/lib/gcc/x86_64-pc-msys/11.3.0/include/c++/x86_64-pc-msys
 /usr/lib/gcc/x86_64-pc-msys/11.3.0/include/c++/backward
 /usr/lib/gcc/x86_64-pc-msys/11.3.0/include
 /usr/lib/gcc/x86_64-pc-msys/11.3.0/include-fixed
 /usr/include
 /usr/lib/gcc/x86_64-pc-msys/11.3.0/../../../../lib/../include/w32api
```


### 多源文件程序的构建

#### C/C++ 构建流程

#### 运用 Make 进行构建

## 代码架构

### 玩转宏定义：`ansi.h` 与 `debug.h`

### 面向对象初步：Minitui 组件库

### 代码整体架构大观